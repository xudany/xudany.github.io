

1.安装初始化一个react + ts 的项目

```bash
npm install -g create-react-app
create-react-app my-app --scripts-version=react-scripts-ts
```



此时的工程结构应如下所示：

```
my-app/
├─ .gitignore
├─ node_modules/
├─ public/
├─ src/
│  └─ ...
├─ package.json
├─ tsconfig.json
└─ tslint.json
```

注意：

- `tsconfig.json`包含了工程里TypeScript特定的选项。
- `tslint.json`保存了要使用的代码检查器的设置，[TSLint](https://github.com/palantir/tslint)。
- `package.json`包含了依赖，还有一些命令的快捷方式，如测试命令，预览命令和发布应用的命令。
- `public`包含了静态资源如HTML页面或图片。除了`index.html`文件外，其它的文件都可以删除。
- `src`包含了TypeScript和CSS源码。`index.tsx`是强制使用的入口文件。



待拓展

2. 增加ignore文件

   ```bash
   # See https://help.github.com/ignore-files/ for more about ignoring files.
   
   # dependencies
   /node_modules
   
   # testing
   /coverage
   
   # production
   /build
   
   # misc
   .DS_Store
   .env.local
   .env.development.local
   .env.test.local
   .env.production.local
   .idea
   
   npm-debug.log*
   yarn-debug.log*
   yarn-error.log*
   
   ```

   

3. 增加目录结构

   增加src目录下的结构

   ```
   src/
   ├─ actions/
   │  └─index.ts
   ├─ assets/
   │  └─logo.svg
   ├─ components/
   │  └─ Menu.tsx
   ├─ containers/
   │  └─ Menu.ts
   ├─ interface/
   │  └─index.ts
   ├─ layouts/
   		├─ PageLayout/
   		│  └─index.tsx
   		├─ BasicLayout.tsx
   ├─ pages/
   │  └─ index.tsx
   ├─ reducers/
   │  └─ index.ts
   ├─ sagas/
   │  └─index.ts
   ├─ services/
   │  └─api.ts
   ├─ utils/
   │  └─Logger.ts
   ├─ webpack/
   └─ App.tsx
   ```

4. 增加Logger

  ```javascript
  export interface Logger {
      trace(message?: any, ...param: any[]): void;
  
      debug(message?: any, ...param: any[]): void;
  
      info(message?: any, ...param: any[]): void;
  
      warn(message?: any, ...param: any[]): void;
  
      error(message?: any, ...param: any[]): void;
  }
  
  class LoggerClass implements Logger {
  
      protected moduleName: string = '';
      protected TIMESTAMP: string = 'YYYY-MM-DD HH:mm:ss.sss';
  
      constructor(moduleName: string) {
          this.moduleName = moduleName;
      }
  
      public trace(message?: any, ...param: any[]): void {
          // console.trace(`[${moment().format(this.TIMESTAMP)}] [${this.moduleName}]`, message, ...param);
          console.trace(`[${this.moduleName}]`, message, ...param);
  
      }
  
      public debug(message?: any, ...param: any[]): void {
          // console.debug(`[${moment().format(this.TIMESTAMP)}] [${this.moduleName}]`, message, ...param);
          console.trace(`[${this.moduleName}]`, message, ...param);
  
      }
  
      public info(message?: any, ...param: any[]): void {
          // console.info(`[${moment().format(this.TIMESTAMP)}] [${this.moduleName}]`, message, ...param);
          console.trace(`[${this.moduleName}]`, message, ...param);
  
      }
  
      public warn(message?: any, ...param: any[]): void {
          // console.warn(`[${moment().format(this.TIMESTAMP)}] [${this.moduleName}]`, message, ...param);
          console.trace(`[${this.moduleName}]`, message, ...param);
  
      }
  
      public error(message?: any, ...param: any[]): void {
          // console.error(`[${moment().format(this.TIMESTAMP)}] [${this.moduleName}]`, message, ...param);
          console.trace(`[${this.moduleName}]`, message, ...param);
  
      }
  }
  
  export function createLogger(moduleName: string): Logger {
      return new LoggerClass(moduleName);
  }
  
  export function LoggerDecorator(target: string): any;
  export function LoggerDecorator(target: object, propertyKey: string): void;
  export function LoggerDecorator(target: any, propertyKey?: any): any {
      if (typeof target === "object") {
          target[propertyKey] = createLogger(target.constructor.name);
      } else {
          return function (tar: any, pKey: string): any {
              tar[pKey] = createLogger(target);
          };
      }
  }
  ```




5. 添加路由

```bash
 npm install react-router-dom --save
 npm install @types/react-router-dom --save-dev
```



6. 添加antd 

```bash
npm install antd —-save
```

按需引入组件

```bash
npm install react-app-rewired --save-dev
```

修改package.json的配置

```json
/* package.json */
"scripts": {
-   "start": "react-scripts start",
+   "start": "react-app-rewired start --scripts-version react-scripts-ts",
-   "build": "react-scripts build",
+   "build": "react-app-rewired build --scripts-version react-scripts-ts",
-   "test": "react-scripts test --env=jsdom",
+   "test": "react-app-rewired test --env=jsdom --scripts-version react-scripts-ts",
}
```

然后在项目根目录创建一个 `config-overrides.js` 用于修改默认配置。

```js
module.exports = function override(config, env) {
  // do stuff with the webpack config...
  return config;
};
```

使用 ts-import-plugin

​       [ts-import-plugin](https://github.com/Brooooooklyn/ts-import-plugin) 是一个用于按需加载组件代码和样式的 TypeScript 插件（[原理](http://beta.ant.design/docs/react/getting-started-cn#按需加载)），现在我们尝试安装它并修改 `config-overrides.js` 文件。

  ```bash
  $npm install ts-import-plugin --save-dev
  ```
  ```javascript
  /* config-overrides.js */
  const tsImportPluginFactory = require('ts-import-plugin')
  const { getLoader } = require("react-app-rewired");

  module.exports = function override(config, env) {
    const tsLoader = getLoader(
      config.module.rules,
      rule =>
        rule.loader &&
        typeof rule.loader === 'string' &&
        rule.loader.includes('ts-loader')
    );

    tsLoader.options = {
      getCustomTransformers: () => ({
        before: [ tsImportPluginFactory({
          libraryName: 'antd',
          libraryDirectory: 'es',
          style: 'css',
        }) ]
      })
    };

    return config;
  }
  ```

  然后移除前面在 `src/App.css` 里全量添加的 `@import '~antd/dist/antd.css';` 样式代码，并且按下面的格式引入模块。

  ```javascript
  import * as React from 'react';
  import { Button } from 'antd';
  import './App.css';

  class App extends React.Component {
    render() {
      return (
        <div className="App">
          <Button type="primary">Button</Button>
        </div>
      );
    }
  }

  export default App;
  ```



报错：

```bash
Cannt find module react-scripts-ts/config/webpack.config
```

解决：

使用`yarn add react-app-rewired@1.6.2`或`npm install react-app-rewired@1.6.2`退回到react-app-rewired的1.x版本的最后一个版本

原因：

> This has been caused by recent changes to CRA (2.1.2) where they merged the `webpack.config.dev.js` and `webpack.config.prod.js` into a single file `webpack.config.js`. See [#343](https://github.com/timarney/react-app-rewired/issues/343) and [#345](https://github.com/timarney/react-app-rewired/issues/345) for more details on the change.
>
> The adjustment to paths made in `react-app-rewired` in order to continue to be able to be used with CRA looks for a `react-scripts` version number greater than or equal to 2.1.2. The `react-scripts-ts`version number has been higher than that for the last ~18 months, so `react-app-rewired` is treating it according to the merged webpack config instead of the split one.
>
> To solve it, you'll need to install an older version of `react-app-rewired` that doesn't have this change. I believe the last version of `react-app-rewired` that will be compatible with `react-scripts-ts` is version `1.6.2`. The versions for 2.x have the breaking change to support CRA 2.1.2 and beyond that is misfiring on `react-scripts-ts`.
>
> Use `yarn add react-app-rewired@1.6.2` or `npm install react-app-rewired@1.6.2` to step back to the last of the 1.x versions of react-app-rewired - it will install the older version and lock the version number to exactly that version so that it doesn't get upgraded to a newer version accidentally in future.

参考： <https://github.com/timarney/react-app-rewired/issues/358>

报错：

```bash
The key 'libraryDirectory' is not sorted alphabetically
```

解决：

 config-overrides.js 文件里交换下libraryName和libraryDirectory的位置。

参考： <https://github.com/ant-design/ant-design/issues/10533>

报错：

```bash
interface name must not have an "I" prefix
```

解决：

根据参考网址添加

```json
"interface-name" : [true, "never-prefix"]
```

对我的项目而言无效，需要修改成

```json
"interface-name": false
```

即是在tslint.json的rules中添加

```json
{
  "extends": [
    "tslint:recommended",
    "tslint-react",
    "tslint-config-prettier"
  ],
  "linterOptions": {
    "exclude": [
      "config/**/*.js",
      "node_modules/**/*.ts",
      "coverage/lcov-report/*.js"
    ]
  },
  "rules": {
    // 添加这一句
    "interface-name": false,
    ...
  }
}

```

参考： <https://github.com/palantir/tslint/issues/3265>



7. 安装lodash

   ```bash
   npm install lodash --save
   npm install @types/lodash --save-dev
   ```
   
8. 安装redux
	```bash
   npm install react-redux --save
   npm install redux --save
   npm install @types/react-redux --save-dev
	```

	
	
9. 安装[redux-actions](https://github.com/redux-utilities/redux-actions)

   GitHub地址：<https://github.com/redux-utilities/redux-actions>

   当在开发大型应用的时候，对于大量的action，reducer需要些大量的swich来对action.type进行判断。

   redux-actions可以简化这一烦琐的过程，它可以是actionCreator，也可以用来生成reducer，其作用都是用来简化action、reducer。主要函数有createAction、createActions、handleAction、handleActions、combineActions。

   ```bash
   npm install redux-actions --save
   npm install @types/redux-actions --save-dev
   ```

   

10. 安装[humps](https://github.com/domchristie/humps)

  用于JavaScript中的字符串和对象键的下划线到驼峰写法的转换器(反之亦然)。

  GitHub地址：<https://github.com/domchristie/humps>

  ```bash
  npm install humps --save
  npm install @types/humps --save-dev
  ```

  基本用法：

  转换字符串

  ```
  humps.camelize('hello_world') // 'helloWorld'
  humps.decamelize('fooBar') // 'foo_bar'
  humps.decamelize('fooBarBaz', { separator: '-' }) // 'foo-bar-baz'
  ```

  转换对象键

  ```
  var object = { attr_one: 'foo', attr_two: 'bar' }
  humps.camelizeKeys(object); // { attrOne: 'foo', attrTwo: 'bar' }
  ```

  对象数组也被转换

  ```
  var array = [{ attr_one: 'foo' }, { attr_one: 'bar' }]
  humps.camelizeKeys(array); // [{ attrOne: 'foo' }, { attrOne: 'bar' }]
  ```



11. 增加 [redux-devtools-extension](<https://github.com/zalmoxisus/redux-devtools-extension>)

    Redux DevTools的扩展，更好看的页面

    ```bash
    npm install --save-dev redux-devtools-extension
    ```

    

12. 增加action和reducers



13. 增加less

    ```bash
    npm install --save-dev less less-loader
    ```

    

14. history

    history是一个JavaScript库，可以让您轻松地在JavaScript运行的任何地方管理会话历史。history抽象了不同环境中的差异，并提供了一个最小的API，允许您管理历史堆栈、导航、确认导航和会话之间的持久状态。

    ```bash
    npm install --save history
    ```

    